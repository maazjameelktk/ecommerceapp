<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My E-Commerce App</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #2980b9;
  color: #fff;
  margin: 0;
  padding: 20px;
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
#welcomeMsg { font-size: 1.5em; font-weight: bold; }
#logoutBtn, #cartBtn, #aboutBtn { 
  background-color: #e74c3c; border:none; color:#fff; padding:8px 12px; cursor:pointer; border-radius:5px; margin-left:5px;
}
#products {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(250px,1fr));
  gap: 20px;
}
.product {
  background: rgba(255,255,255,0.1);
  border-radius:10px; padding:15px;
  text-align:center;
  transition: 0.2s;
}
.product img { width:100%; max-height:180px; object-fit:cover; border-radius:10px; margin-bottom:10px; }
.product:hover { transform: translateY(-5px); box-shadow:0 10px 20px rgba(0,0,0,0.3); }
button.addToCartBtn { background-color:#2ecc71; margin-top:10px; padding:10px; width:100%; border:none; border-radius:5px; cursor:pointer; }
.modal {
  position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6);
  display:none; align-items:center; justify-content:center;
}
.modalContent {
  background:#3498db; padding:20px; border-radius:10px; width:400px; max-height:80%; overflow:auto; position:relative;
}
.modalContent h2 { text-align:center; }
.closeModal { position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer; color:#fff; }
.cartItem { display:flex; justify-content:space-between; margin:10px 0; background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:5px; }
.checkoutBtn { background:#2ecc71; padding:10px; width:100%; border:none; border-radius:5px; cursor:pointer; margin-top:10px; }
.paymentOption { margin:5px 0; }
</style>
</head>
<body>

<header>
  <div id="welcomeMsg">Hello, User</div>
  <div>
    <button id="aboutBtn">About Us</button>
    <button id="cartBtn">Cart (0)</button>
    <button id="logoutBtn">Logout</button>
  </div>
</header>

<div id="products">Loading products...</div>

<!-- Cart Modal -->
<div id="cartModal" class="modal">
  <div class="modalContent">
    <span class="closeModal" onclick="closeCart()">&times;</span>
    <h2>Your Cart</h2>
    <div id="cartItems"></div>
    <div>
      <h3>Payment Method</h3>
      <label class="paymentOption"><input type="radio" name="payment" value="EasyPaisa" checked> EasyPaisa</label><br>
      <label class="paymentOption"><input type="radio" name="payment" value="Debit Card"> Debit Card</label>
    </div>
    <button class="checkoutBtn" onclick="checkout()">Checkout</button>
  </div>
</div>

<!-- About Modal -->
<div id="aboutModal" class="modal">
  <div class="modalContent">
    <span class="closeModal" onclick="closeAbout()">&times;</span>
    <h2>About Us</h2>
    <p>Owner: Maaz Khattak</p>
    <p>Email: maaz@example.com</p>
    <p style="font-weight:bold; font-size:1.2em; animation:blink 1s infinite;">Thanks for choosing and trusting our app!</p>
  </div>
</div>

<script>
// User name
const userName = localStorage.getItem("userName") || "User";
document.getElementById("welcomeMsg").innerText = `Hello, ${userName}`;

// Logout
document.getElementById("logoutBtn").addEventListener("click", ()=>{
  localStorage.removeItem("userName");
  window.location.href = "index.html";
});

// About Modal
const aboutModal = document.getElementById("aboutModal");
document.getElementById("aboutBtn").addEventListener("click", ()=>{ aboutModal.style.display="flex"; });
function closeAbout(){ aboutModal.style.display="none"; }
aboutModal.addEventListener("click", e=>{ if(e.target===aboutModal) closeAbout(); });

// Cart
let cart = [];
const cartBtn = document.getElementById("cartBtn");
const cartModal = document.getElementById("cartModal");
function openCart(){ renderCart(); cartModal.style.display="flex"; }
function closeCart(){ cartModal.style.display="none"; }
cartBtn.addEventListener("click", openCart);
cartModal.addEventListener("click", e=>{ if(e.target===cartModal) closeCart(); });

// Load products
const productsDiv = document.getElementById("products");
async function loadProducts(){
  try{
    const res = await fetch("api/products.php");
    const data = await res.json();
    if(data.success && data.products.length>0){
      productsDiv.innerHTML="";
      data.products.forEach(p=>{
        const div = document.createElement("div");
        div.classList.add("product");
        div.innerHTML=`
          <img src="${p.image || 'https://via.placeholder.com/250'}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>${p.description}</p>
          <p><strong>$${parseFloat(p.price).toFixed(2)}</strong></p>
          <button class="addToCartBtn">Add to Cart</button>
        `;
        div.querySelector(".addToCartBtn").addEventListener("click", ()=>{
          addToCart(p);
        });
        productsDiv.appendChild(div);
      });
    } else { productsDiv.innerHTML="No products found."; }
  } catch(err){ productsDiv.innerHTML="Failed to load products."; console.error(err); }
}
loadProducts();

// Cart functions
function addToCart(product){
  const exist = cart.find(item=>item.id===product.id);
  if(exist) exist.quantity++;
  else cart.push({...product, quantity:1});
  updateCartButton();
}

function removeFromCart(id){
  cart = cart.filter(item=>item.id!==id);
  updateCartButton();
  renderCart();
}

function updateCartButton(){
  cartBtn.innerText = `Cart (${cart.reduce((a,b)=>a+b.quantity,0)})`;
}

function renderCart(){
  const cartItems = document.getElementById("cartItems");
  cartItems.innerHTML="";
  if(cart.length===0){ cartItems.innerHTML="<p>Cart is empty.</p>"; return; }
  cart.forEach(item=>{
    const div = document.createElement("div");
    div.classList.add("cartItem");
    div.innerHTML=`
      <span>${item.name} x ${item.quantity} - $${(item.price*item.quantity).toFixed(2)}</span>
      <button onclick="removeFromCart(${item.id})">Remove</button>
    `;
    cartItems.appendChild(div);
  });
}

function checkout(){
  if(cart.length===0){ alert("Cart is empty!"); return; }
  const payment = document.querySelector('input[name="payment"]:checked').value;
  alert(`Payment of $${cart.reduce((a,b)=>a+b.price*b.quantity,0).toFixed(2)} successful via ${payment}!`);
  cart=[];
  updateCartButton();
  renderCart();
}

// Animation
const style = document.createElement('style');
style.innerHTML=`@keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}`;
document.head.appendChild(style);
</script>

</body>
</html>
